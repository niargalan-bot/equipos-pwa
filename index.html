<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Armar Equipos Parejos</title>
  <meta name="theme-color" content="#10b981" />
  <link rel="manifest" href="manifest.webmanifest" />
</head>
<body>
  <h1>âš½ Armar Equipos Parejos</h1>
  <button id="addBtn">+ Agregar jugador</button>
  <button id="exampleBtn">Cargar ejemplo</button>
  <div id="playersList"></div>

  <dialog id="dlg">
    <form id="playerForm" method="dialog">
      <label>Nombre <input id="f_nombre" required></label><br>
      <label>Ataque <input type="number" id="f_ataque" min="1" max="10" value="6"></label><br>
      <label>Defensa <input type="number" id="f_defensa" min="1" max="10" value="6"></label><br>
      <label>Arquero <input type="number" id="f_arquero" min="0" max="10" value="3"></label><br>
      <label>Resistencia <input type="number" id="f_resistencia" min="1" max="10" value="6"></label><br>
      <label>Overall (auto) <input type="number" id="f_overall" readonly disabled></label><br>
      <button value="cancel">Cancelar</button>
      <button id="saveBtn" value="default">Guardar</button>
    </form>
  </dialog>

<script>
const KEY='equipos_auto_v1';
const $=s=>document.querySelector(s);
let players=JSON.parse(localStorage.getItem(KEY)||'[]');
const save=()=>localStorage.setItem(KEY,JSON.stringify(players));
const computeOverall=p=>Math.round(((+p.ataque+(+p.defensa)+(+p.arquero)+(+p.resistencia))/4)*10)/10;
const recomputeAll=()=>{players=players.map(p=>({...p,overall:computeOverall(p)}));save();};

let editing=null;
function renderPlayers(){ $('#playersList').innerHTML=players.map(p=>`<div><b>${p.nombre}</b> (Ovr ${p.overall})</div>`).join(''); }
function openForm(p){
  editing=p?{...p}:{id:crypto.randomUUID(),nombre:'',ataque:6,defensa:6,arquero:3,resistencia:6,overall:6};
  $('#f_nombre').value=editing.nombre;
  $('#f_ataque').value=editing.ataque;
  $('#f_defensa').value=editing.defensa;
  $('#f_arquero').value=editing.arquero;
  $('#f_resistencia').value=editing.resistencia;
  const recalc=()=>{
    const tmp={ataque:$('#f_ataque').value,defensa:$('#f_defensa').value,arquero:$('#f_arquero').value,resistencia:$('#f_resistencia').value};
    $('#f_overall').value=computeOverall(tmp);
  };
  ['#f_ataque','#f_defensa','#f_arquero','#f_resistencia'].forEach(sel=>$(sel).oninput=recalc);
  recalc();
  $('#dlg').showModal();
}
$('#addBtn').onclick=()=>openForm(null);
$('#saveBtn').onclick=e=>{e.preventDefault();editing.nombre=$('#f_nombre').value;
editing.ataque=+$('#f_ataque').value;editing.defensa=+$('#f_defensa').value;editing.arquero=+$('#f_arquero').value;editing.resistencia=+$('#f_resistencia').value;
editing.overall=computeOverall(editing);const i=players.findIndex(x=>x.id===editing.id);if(i>=0)players[i]=editing;else players.push(editing);save();renderPlayers();$('#dlg').close();};
$('#exampleBtn').onclick=()=>{players=[{id:crypto.randomUUID(),nombre:'Nico',ataque:7,defensa:6,arquero:2,resistencia:7},{id:crypto.randomUUID(),nombre:'Ari',ataque:6,defensa:5,arquero:1,resistencia:6},{id:crypto.randomUUID(),nombre:'Lucho',ataque:6,defensa:7,arquero:2,resistencia:6}];recomputeAll();renderPlayers();};
recomputeAll();renderPlayers();
</script>

<script>
if('serviceWorker' in navigator){window.addEventListener('load',()=>navigator.serviceWorker.register('./sw.js').catch(()=>{}));}
</script>
</body>
</html>